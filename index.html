<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Optimizando Rails</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Alter Lagos">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/custom.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section>
          <h1>Optimizando Rails</h1>
          <p>Por Alter Lagos</p>
          <p>
            <a href="http://twitter.com/nomesigaporfa">
            	<small>@nomesigaporfa</small>
            </a>
          </p>
        </section>

        <section>
          <h2>Sistema de ejemplo</h2>
          <img src="images/1.png">
          <p>
            <a href="https://github.com/wdblair/Rails-Seed-All-Countries-and-All-States">github.com/wdblair/Rails-Seed-All-Countries-and-All-States</a>
          </p>
        </section>

        <section>
          <h2>Active Record</h2>
          <h3>Queries N+1</h3>
          <pre><code contenteditable class="erb">
  <% @countries.each do |country| %>
    &lt;tr&gt;
      &lt;td&gt;<%= country.name %>&lt;/td&gt;
      &lt;td&gt;<%= country.iso %>&lt;/td&gt;
      <% if !country.states.blank? %>
        &lt;td&gt;<%= country.states.count %>&lt;/td&gt;
        &lt;td&gt;<%= country.states.first.name %>&lt;/td&gt;
      <% end %>
    &lt;/tr&gt;
  <% end %>
          </code></pre>
        </section>

        <section class="big_section">
          <h2>Active Record</h2>
          <h3>Queries N+1</h3>
          <pre class="big_code"><code contenteditable>
Started GET "/" for 127.0.0.1 at 2012-11-25 20:24:53 -0300
Processing by CountriesController#index as HTML
  Country Load (0.4ms)  SELECT `countries`.* FROM `countries` 
  State Load (0.7ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 1
   (0.6ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 1
  State Load (0.8ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 2
   (0.7ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 2
  State Load (0.8ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 3
   (0.5ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 3
  State Load (0.6ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 4
   (0.6ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 4
  State Load (0.6ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 5
   (0.5ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 5
  State Load (0.6ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 6
   (0.6ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 6
  State Load (0.7ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 7
   (0.6ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 7
  State Load (0.7ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 8
   (0.6ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 8
  State Load (0.6ms)  SELECT `states`.* FROM `states` WHERE `states`.`country_id` = 9
   (0.5ms)  SELECT COUNT(*) FROM `states` WHERE `states`.`country_id` = 9
          </code></pre>
          <h4 class="fragment">Bullet <a href="http://github.com/flyerhzm/bullet">github.com/flyerhzm/bullet</a></h4>
        </section>

        <section>
          <h2>Active Record</h2>
          <h3>Indices</h3>
          <pre><code contenteditable class="ruby">
  add_index :countries, [:name]
  add_index :states, [:country_id, :name]
          </code></pre>
          <div class="fragment">
            <h4>Foreigner <a href="https://github.com/matthuhiggins/foreigner">github.com/matthuhiggins/foreigner</a></h4>
            <h4>Immigrant <a href="https://github.com/jenseng/immigrant">github.com/jenseng/immigrant</a></h4>
          </div>
        </section>

        <section>
          <h2>Active Record</h2>
          <h3>Orden Importa</h3>
          <pre><code contenteditable class="ruby">
  State.where('country_id = ? and name like ?', id, "%#{name}%")
  # No es lo mismo que...
  State.where('name like ? and country_id = ?', "%#{name}%", id)
          </code></pre>
          <pre class="fragment"><code contenteditable class="ruby">
  add_index :states, [:country_id, :name]
  # No es lo mismo que...
  add_index :states, [:name, :country_id]
          </code></pre>
        </section>

        <section>
          <h2>Active Record</h2>
          <h3>Orden Importa</h3>
          <pre><code contenteditable>
> State.select('count(distinct country_id), count(distinct name)')

+----------------------------+----------------------+
| count(distinct country_id) | count(distinct name) |
+----------------------------+----------------------+
| 221                        | 3704                 |
+----------------------------+----------------------+
1 row in set
          </code></pre>
        </section>

        <section>
          <h2>Active Record</h2>
          <h3>Cache Queries</h3>
        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: false,
        rollingLinks: false,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
